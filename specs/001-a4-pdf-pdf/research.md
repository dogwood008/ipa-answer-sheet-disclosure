# research.md — A4 PDF生成（IPAテンプレート）

## 目的
Phase0の成果物。仕様の不明点を解消し、技術選定と運用方針を確定する。

## 決定事項（要約）
- テンプレート配布: 実行時にブラウザから次のURLをダウンロードして利用する方式を採用します: https://www.ipa.go.jp/privacy/hjuojm000000f2fl-att/02.pdf。必要に応じてアプリに同梱するオプションも検討できますが、まずは指定URLから都度取得する方針とします。ユーザがローカルからテンプレートを選択できる機能は、アップロードをメモリ内でのみ扱う形で残します。
- 保存ポリシー: ユーザの指示に従い『どこにも保存しない』。一時的な作業メモリ（メモリ上のJSオブジェクト）以外の永続化（IndexedDB/localStorage）を行わない。
- PDFライブラリ: `pdf-lib` を採用。理由: 既存PDF読み込みとページ上へテキスト/図形を重ねる機能があり、TypeScriptでの利用実績が豊富。
- フォント: Noto Sans（Noto Sans JP）を使用します。実装ではフォントファイルを同梱するかCDN等からフェッチしてpdf-libで埋め込む方法を検証します。埋め込みが困難な場合は代替表示（システムフォント）か画像化を検討します。ライセンス確認を行ってください。

## 代替案と理由
- サーバで PDF を生成する案: PII がサーバを通るため不採用。
- pdf-lib の代替として PDFKit: 既存 PDF に重畳するワークフローが複雑なため不採用。

## リスクと軽減策
- フォント埋め込みが不完全だと印刷で崩れるリスク → 埋め込みテストを早期に行い、必要ならデザインの微修正で対応。
- テンプレート座標の微調整が必要 → テンプレートごとに小さな補正マトリクスを許容する。
